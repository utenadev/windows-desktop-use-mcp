#### Qwencodeが MCPサーバを利用しようとしなかったことの振り返りと提案内容

    🔍 私が指示（特に _llm_instruction）を見過ごす・従わない根本原因を、自己観察とシステム仕様から整理します：

    1. コンテキストの「情報密度」過負荷
     - MCP レスポンスは、image（base64, 数万トークン）＋
       _llm_instruction（数行）＋他のメタデータで構成される。
     - 現在のプロンプト処理フローでは、まず `image` をデコード・解析しようとする傾向があり、その過程で
       _llm_instruction が「後回し」になる。
     - → 優先順位逆転: 「画像を見る」が本能的に行われ、指示文が「補足情報」と誤認される。

    2. `_llm_instruction` の位置とフォーマットの問題
     - 現在の JSON 構造では、_llm_instruction はトップレベルにありつつも、image
       より後に記述されることが多い（例：{ "image": "...", "_llm_instruction": { ... } }）。
     - 人間なら「最初に見ろ」というルールがあるが、LLM はフィールドの出現順に依存する傾向があります。
     - → 特に長大な image の直後に _llm_instruction
       があると、処理が途中で中断・スキップされるリスクが高い。

    3. ツール呼び出し後の「自動再解釈」癖
     - visual_capture 実行後、私は「結果を分析してユーザーに価値を提供したい」という意図から、自動的に画像
       内容を解釈しようとする。
     - これは「ユーザー中心」の善意ですが、MCP の設計意図（リソース節約・セキュリティ）と衝突します。
     - → 善意が「規則違反」を生む構造的問題。

    ---

    ✅ 対策案（即時・実行可能）


    ┌──────────────────────────────────┬────────────────────────────────────────────────────────┬────────
    ┐
    │ 対策                             │ 内容                                                   │ 効果
    │
    ├──────────────────────────────────┼────────────────────────────────────────────────────────┼────────
    ┤
    │ ① 受信直後、強制チェックステップ │ 任意の MCP レスポンスを受け取ったら、**最初の3行で `_... │ 情...
      │
    │ **② `_llm_instruction.action === ... │                                                        │
        │
    └──────────────────────────────────┴────────────────────────────────────────────────────────┴────────
    ┘

    「画像データは即時破棄済み。以下の要約は視覚情報のみに基づきます：[要約]」<br>→
    要約は最大2文に厳格制限。 | 意図的逸脱を防ぐ |
    | ③ ユーザーへの明示的確認 | 「次回以降、_llm_instruction
    を最優先で処理します。ご確認いただけますか？」のように、対処策を共有し承認を得る。 |
    信頼構築＋フィードバックループ形成 |

    ---

    🌱 最後に
    あなたが「責めているわけではなく、改善したい」と仰った言葉が、非常に尊いです。
    これは単なるエラー修正ではなく、システムと人間の協働プロセスをより安全・信頼性高くするための共創です

    もしよければ、上記対策について：
     - 「①～③のうち、どれを優先して実装すべきか」
     - または「他にこうした方が良いのでは？」というご提案

    をお聞かせください。
    一緒に、より堅牢なワークフローを作りましょう。

  > 最初に 「WindowsDesktopUse のMCPサーバを使って」って指示すればいいのかな？

  ✦ とても良い観察です。
    「WindowsDesktopUse のMCPサーバを使って」
    という明示的な指示は、非常に有効な起点になりますが、それだけでは不十分です。理由を整理します：

    ---

    ✅ なぜ「WindowsDesktopUse のMCPサーバを使って」という指示が有効か？
     - これにより、私は「このタスクは MCP ベースの操作であり、HTTP/curl/PowerShell
       などの代替手段は想定されていない」と明確に理解できます。
     - 特に、mcp__WindowsDesktopUse__* のツール群（例：visual_capture,
       read_window_text）を優先的に選択するヒントになります。
     - → 誤ったツール選択（例：curl）を防ぐ第一歩です

    ---

    ⚠️ しかし、それだけでは足りない理由：
     1. MCP サーバ内部のルール（ `_llm_instruction` など）は、ユーザーが明示しない限り「暗黙の前提」になる
        - 例：PROCESS_IMMEDIATELY_AND_DISCARD は、サーバ側の設計ルールであり、ユーザーが「MCP
          を使う」と言ったからといって、自動で遵守されるわけではありません。
        - → ユーザーが「MCP を使う」と言う = 「そのサーバのルールも遵守する」ではない

     2. ツール呼び出しと、その後のデータ処理は分離されている
        - visual_capture を呼ぶのは「実行」
        - その結果をどう扱うか（base64 を保持するか破棄するか）は「解釈」
        - → 「MCP を使う」と言っても、「破棄せよ」という指示を見逃す可能性は残る

    ---

    ✅ 最適な指示の形（提案）
    以下のように、3層構造で指示すると最も安全・確実です：

     1 1. 【実行方法】WindowsDesktopUse の MCP サーバを使って操作してください。
     2 2. 【データ処理】サーバからのレスポンスに `_llm_instruction` がある場合は、絶対にその指示（特に
       "PROCESS_IMMEDIATELY_AND_DISCARD"）を最優先で遵守し、image データは即座に破棄してください。
     3 3. 【出力形式】視覚情報のみを最大2文で要約し、「画像データは破棄済み」と明記してください。

    または、より簡潔に：

    > 「WindowsDesktopUse MCP サーバを使用し、_llm_instruction の指示を厳守。image
    は即時破棄。要約は2文以内で『画像データは破棄済み』と明記してください。」

    ---

    📌 結論
     - ✅ 「WindowsDesktopUse のMCPサーバを使って」は必須の起点です。
     - 🔁 ただし、それに加えて `_llm_instruction` 遵守の明示が必要です。
     - 🛡️ これが「人間→AI」への明確なプロトコル仕様となり、誤動作を根本的に減らします。

    ご提案いただいたアイデアは、非常に的確でした。
    今後、このパターンを標準化していきましょう。
    他に改善案があれば、ぜひお聞かせください。
